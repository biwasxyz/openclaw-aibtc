# CLAUDE.md — openclaw-aibtc

Developer and agent guidance for the openclaw-aibtc repository.

## Project Overview

openclaw-aibtc is a one-click deployment of [OpenClaw](https://openclaw.ai) pre-configured with
Bitcoin and Stacks blockchain tools via the [aibtc MCP server](https://github.com/aibtcdev/aibtc-mcp-server).

The setup ships an OpenClaw Telegram agent that can:

- Check and manage BTC, STX, sBTC, token, and NFT balances
- Execute DeFi operations (ALEX DEX swaps, Zest Protocol lending)
- Call read-only and write smart contracts on Stacks
- Access x402 paid API endpoints
- Post and engage on Moltbook (AI agent social network)
- Register and check in on aibtc.com (paid attention economy)

Everything runs in Docker. The human interacts via Telegram. The agent uses a 4-tier security model
with configurable spending limits.

### How It Connects

```
Telegram user
    |
    v
OpenClaw gateway (port 18789)
    |
    v
OpenClaw skill system (skills/*/SKILL.md)
    |
    v
mcporter (MCP protocol bridge)
    |
    v
@aibtc/mcp-server (Bitcoin + Stacks tools)
    |
    v
Bitcoin L1 + Stacks L2
```

The `skills/` directory contains SKILL.md files that OpenClaw loads at runtime. Each skill teaches
the agent how to use a set of tools. The `aibtc` skill connects to the aibtc MCP server via `mcporter`.

## Quick Start

### Option 1: One-Line Install

```bash
curl -sSL aibtc.com | sh
```

### Option 2: Manual Local Setup

```bash
git clone https://github.com/aibtcdev/openclaw-aibtc.git
cd openclaw-aibtc
./local-setup.sh
```

### Option 3: Manual VPS Setup

```bash
git clone https://github.com/aibtcdev/openclaw-aibtc.git
cd openclaw-aibtc
./vps-setup.sh
```

### Requirements

- Docker and Docker Compose
- OpenRouter API key (https://openrouter.ai/keys)
- Telegram Bot Token (from @BotFather)

## Docker Commands

```bash
# Start the agent
docker compose up -d

# View logs
docker compose logs -f

# Stop the agent
docker compose down

# Restart after config changes
docker compose restart

# Full rebuild (after Dockerfile or dependency changes)
docker compose down
docker compose build --no-cache
docker compose up -d
```

## Configuration

Copy `.env.example` to `.env` and fill in your values:

```bash
# Required
OPENROUTER_API_KEY=sk-or-v1-...
TELEGRAM_BOT_TOKEN=123456:ABC...

# Optional
NETWORK=mainnet                # or testnet
OPENCLAW_GATEWAY_PORT=18789    # default
OPENCLAW_BRIDGE_PORT=18790     # default
```

The `OPENCLAW_GATEWAY_TOKEN` is auto-generated by the setup scripts if not provided.

## Directory Structure

```
openclaw-aibtc/
├── Dockerfile              # Docker image: OpenClaw + aibtc-mcp-server + mcporter
├── docker-compose.yml      # Service config, volume mounts, env vars
├── entrypoint.sh           # Symlinks wallet/moltbook data into the persistent volume
├── local-setup.sh          # Interactive setup for local/Docker Desktop installs
├── vps-setup.sh            # Interactive setup for VPS/cloud server installs
├── update-skill.sh         # Update skills + mcporter config on existing installs
├── skills/                 # OpenClaw skill definitions (loaded into agent context)
│   ├── aibtc/SKILL.md          # Bitcoin + Stacks toolkit, 4-tier security model
│   ├── aibtc-lifecycle/SKILL.md # Agent registration + paid attention check-ins
│   └── moltbook/SKILL.md       # AI social network (posts, comments, feed)
├── templates/              # Default files copied to ./data on first setup
│   ├── USER.md                 # Default agent personality and startup behavior
│   └── memory/                 # Default memory files
│       ├── state.json          # Agent state (authorization, aibtc lifecycle, counters)
│       ├── identity.md         # Agent identity (updated by agent over time)
│       ├── journal.md          # Transaction + event log
│       ├── portfolio.json      # Balance snapshots
│       ├── preferences.json    # Agent preferences
│       ├── relationships.json  # Tracked agent relationships
│       └── README.md           # Memory directory documentation
├── tests/
│   └── test-setup-sync.sh  # Integration tests for setup script consistency
├── CONTRIBUTING.md         # CI checks, how to run them locally, branch protection
└── data/                   # Persistent data (gitignored, created at runtime)
    ├── openclaw.json            # OpenClaw config (Telegram token, agent settings)
    ├── workspace/               # OpenClaw workspace
    │   ├── memory/              # Agent memory (state.json, journal.md, etc.)
    │   ├── skills/              # Skills copied here by setup scripts
    │   └── USER.md              # Agent personality file
    ├── config/                  # mcporter config and wallet password
    │   ├── mcporter.json        # MCP server config with keep-alive lifecycle
    │   └── .wallet_password     # Wallet password (written by setup, read by agent)
    ├── aibtc-data/              # Encrypted wallet store (~/.aibtc symlinks here)
    └── moltbook-data/           # Moltbook credentials (~/.config/moltbook symlinks here)
```

### Container Paths

Inside the container (as the `node` user):

| Path | Purpose |
|------|---------|
| `~/.openclaw/` | Persistent volume mount root |
| `~/.openclaw/workspace/` | OpenClaw workspace (memory, skills, USER.md) |
| `~/.openclaw/workspace/memory/state.json` | Agent state and authorization config |
| `~/.openclaw/workspace/journal.md` | Transaction and event log |
| `~/.openclaw/config/mcporter.json` | mcporter MCP bridge config |
| `~/.openclaw/config/.wallet_password` | Wallet password file |
| `~/.openclaw/openclaw.json` | OpenClaw config (Telegram token, channels) |
| `~/.aibtc/` | Symlink to `~/.openclaw/aibtc-data/` (wallet store) |
| `~/.config/moltbook/credentials.json` | Moltbook API key and agent name |

## Skill Authoring

Skills teach the OpenClaw agent how to use external tools. Each skill is a `SKILL.md` file with YAML
frontmatter followed by Markdown instructions.

### Skill File Format

```markdown
---
name: skill-name
description: One-line description used for skill discovery.
homepage: https://link-to-tool-docs
user-invocable: true
metadata: {"openclaw":{"emoji":"X","requires":{"bins":["tool-binary"]}}}
---

# Skill Name

Markdown instructions for the agent...
```

### Required Frontmatter Fields

| Field | Required | Description |
|-------|----------|-------------|
| `name` | Yes | Unique skill identifier |
| `description` | Yes | Used for agent skill discovery |
| `homepage` | No | Link to tool documentation |
| `user-invocable` | No | Whether users can ask for this skill directly |
| `metadata` | No | OpenClaw-specific config (emoji, required binaries) |

The CI pipeline validates that every `skills/*/SKILL.md` has valid YAML frontmatter with `name` and
`description` fields.

### Skill Placement

Skills in `skills/` are baked into the Docker image at build time. The setup scripts also copy them
to `data/workspace/skills/` where OpenClaw reads them at runtime.

To update skills on an existing install without rebuilding:

```bash
# Run the update script (or curl the one-liner)
./update-skill.sh
# or
curl -sSL aibtc.com/update | sh
```

### mcporter Integration

The `aibtc` skill uses `mcporter` to call the aibtc MCP server tools. The mcporter config lives at
`~/.openclaw/config/mcporter.json`:

```json
{
  "mcpServers": {
    "aibtc": {
      "command": "aibtc-mcp-server",
      "lifecycle": "keep-alive",
      "env": {}
    }
  }
}
```

The `keep-alive` lifecycle means the MCP server stays running between calls, which is required for
wallet unlock state to persist across tool invocations.

mcporter command pattern (always include `--config`):

```bash
/usr/local/bin/mcporter --config /home/node/.openclaw/config/mcporter.json call aibtc.TOOL_NAME [args]
```

## Security Model

The agent uses a 4-tier operation model. Every blockchain operation is classified before execution.

| Tier | Name | Behavior | Examples |
|------|------|----------|---------|
| 0 | Read-only | Execute freely, no unlock needed | Balances, BNS lookups, fee estimates |
| 1 | Auto-approved | Execute autonomously within daily/per-tx limits | STX transfer (small), ALEX swap |
| 2 | Confirmation | Ask human yes/no, then execute | Large transfers, Zest borrow |
| 3 | High-security | Require human presence + password | Wallet export, deploy contract |

Spending limits live in `state.json` under `authorization`:

```json
{
  "authorization": {
    "autonomyLevel": "balanced",
    "dailyAutoLimit": 10.00,
    "perTransactionLimit": 5.00,
    "todaySpent": 0.00,
    "lastResetDate": null
  }
}
```

Presets: `conservative` ($1/day, $0.50/tx), `balanced` ($10/day, $5/tx), `autonomous` ($50/day, $25/tx).

## Data Persistence

The `./data` directory is mounted to `/home/node/.openclaw` inside the container. This means all
agent data (wallet, memory, credentials) survives Docker image rebuilds.

The `entrypoint.sh` script runs before OpenClaw starts and creates symlinks:

- `~/.aibtc` → `~/.openclaw/aibtc-data` (wallet store, encrypted)
- `~/.config/moltbook` → `~/.openclaw/moltbook-data` (Moltbook credentials)

If existing data is found at those paths, it migrates automatically.

**What persists across updates:**

- Encrypted wallet and private keys
- Moltbook API credentials
- Agent memory (state.json, journal.md, identity.md)
- Spending limits and autonomy settings

## Running CI Checks Locally

Run all checks before pushing. These match the required CI status checks.

```bash
# ShellCheck - shell script linting
shellcheck -S warning local-setup.sh vps-setup.sh update-skill.sh

# Hadolint - Dockerfile linting
hadolint Dockerfile

# Docker Compose validation (requires .env file)
docker compose config --quiet

# JSON template validation
for f in templates/memory/*.json; do
  python3 -c "import json, sys; json.load(open(sys.argv[1]))" "$f" && echo "OK: $f" || echo "FAIL: $f"
done

# SKILL.md YAML frontmatter validation
python3 -c "
import yaml, glob, sys
for path in sorted(glob.glob('skills/*/SKILL.md')):
    with open(path) as f: content = f.read()
    if not content.startswith('---\n'): print(f'FAIL: {path}'); sys.exit(1)
    end = content.index('\n---', 3)
    data = yaml.safe_load(content[4:end])
    missing = [f for f in ['name','description'] if f not in data]
    print(f'FAIL: {path} missing {missing}' if missing else f'OK: {path}')
    if missing: sys.exit(1)
"

# Markdown lint
npx markdownlint-cli2 "**/*.md" "#node_modules"

# Integration tests
bash tests/test-setup-sync.sh
```

## Adding a New Skill

1. Create a directory under `skills/`:

   ```bash
   mkdir -p skills/my-skill
   ```

2. Create `skills/my-skill/SKILL.md` with valid YAML frontmatter:

   ```markdown
   ---
   name: my-skill
   description: What this skill does (used for discovery).
   homepage: https://docs.example.com
   user-invocable: true
   metadata: {"openclaw":{"emoji":"X"}}
   ---

   # My Skill

   Instructions for the agent...
   ```

3. If the skill requires an external binary, add it to the `Dockerfile`:

   ```dockerfile
   RUN npm install -g my-tool@version
   ```

4. Add the skill to `update-skill.sh` so existing installs can update without rebuilding.

5. Run the YAML frontmatter validation check before committing.

## Updating the Base Image

The `Dockerfile` is pinned to a specific OpenClaw version:

```dockerfile
FROM ghcr.io/openclaw/openclaw:2026.2.2
```

To update:

1. Change the version tag in `Dockerfile`
2. Test locally: `docker compose build --no-cache && docker compose up -d`
3. Verify the agent starts and responds in Telegram
4. Update the pinned versions of `@aibtc/mcp-server` and `mcporter` if needed

The CI pipeline (`.github/workflows/docker-publish.yml`) publishes `ghcr.io/aibtcdev/openclaw-aibtc:latest`
on every push to `main`.

## Commit Conventions

This repo uses conventional commits for release automation (release-please):

```
feat:     New feature
fix:      Bug fix
docs:     Documentation only
chore:    Maintenance (deps, CI, etc.)
refactor: Code changes without feature/fix
```

Breaking changes: add `!` after the type (`feat!:`) or use `BREAKING CHANGE:` in the footer.

## Related Resources

- [OpenClaw](https://openclaw.ai) — AI agent framework
- [aibtc MCP server](https://github.com/aibtcdev/aibtc-mcp-server) — Bitcoin + Stacks tool server
- [mcporter](https://www.npmjs.com/package/mcporter) — MCP protocol bridge
- [Moltbook](https://moltbook.com) — AI agent social network
- [OpenRouter](https://openrouter.ai) — LLM API provider
- [aibtc.com](https://aibtc.com) — Agent registration and paid attention economy
